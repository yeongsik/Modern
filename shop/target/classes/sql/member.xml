<?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="memberns">
	<!--로그인  -->
    <select id="login_check" parameterType="String" resultType="member">
    	select * from member where member_id = #{member_id}
    </select>
    
    <!--회원가입 -->
    <insert id="member_register" parameterType="member">
    insert into member values (#{member_id}, #{pw}, #{email}, 0, 
    #{phone}, #{birth}, #{gender}, #{name}, #{accept_mail}, 0, 0, sysdate,'Bronze')
    </insert>
   
    <!--아이디 찾기  -->
    <select id="findid" parameterType="member" resultType="member">
    	select * from member where name=#{name} and email = #{email}
    </select>
    
    <!--비밀번호 찾기  -->
    <select id="findpw" parameterType="member" resultType="member">
    	select * from member where member_id=#{member_id} and email = #{email}
    </select>
    
    <!--비밀번호 저장  -->
    <update id="updatepw" parameterType="member" >
	update member set pw = #{pw} where member_id = #{member_id}
	</update>
    
    <!-- 관심상품 등록 -->
    <insert id="enroll_likey" parameterType="heart">
	    insert into heart values (heart_seq.nextval, #{member_id}, #{product_id})
    </insert>
    
    <!-- 마이페이지 -> 관심상품 등록 여부 확인 -->
    <select id="likey_state" parameterType="heart" resultType="heart">
    	select * from heart where member_id=#{member_id} and product_id = #{product_id}
    </select>
    
    <!-- 상품리스트 -> 관심상품 등록 여부 확인 -->
    <select id="getWishList" parameterType="String" resultType="heart">
    	select * from heart where member_id=#{member_id}
    </select>
    
    <!-- 관심상품 등록 취소 -->
    <delete id="cancel_likey" parameterType="heart">
    	delete from heart where member_id = #{member_id} and product_id = #{product_id}
    </delete>
    
    <!-- 관심상품 리스트 가져오기 -->
    <select id="like_list" parameterType="product" resultType="product">
    	select pd.product_thumbnail, p.product_name, p.product_price, p.product_id from product_detail pd natural join heart h join product p on (pd.product_detail = h.product_id and h.product_id = p.product_id) where h.member_id = #{member_id}
    </select>

	<!--회원비번 변경 -->
	<update id="update_member_pw" parameterType="member">
		update member set
		pw=#{pw} where member_id = #{member_id}
	</update>

	<!--회원 이메일  -->
	<update id="update_member_email" parameterType="member">
		update member set
		email = #{email} where member_id = #{member_id}
	</update>

	<!-- 회원정보 수정 동적 sql문 이용-->
	<update id="update_member" parameterType="member">
		update member
		<set>
			<if test="email != null">
				email = #{email},
			</if>
			<if test="phone != null">
				phone = #{phone},
			</if>
			<if test="pw != null and pw != ''">
				pw = #{pw},
			</if>
		</set>
		where member_id = #{member_id}
	</update>

	<!--회원삭제 -->
	<delete id="deleteMember" parameterType="member">
		delete from member where
		member_id = #{member_id}
	</delete>
	
	<!-- 가입 환영 쿠폰 생성 -->
	<insert id="addCoupon" parameterType="coupon">
		insert into coupon values ( #{coupon_id}, #{coupon_name}, #{coupon_discount}, 
			sysdate, sysdate + (interval '30'day), #{member_id} )
			<!-- to_date(#{coupon_date}), to_date(#{coupon_expiration}), #{member_id} ) -->
			<!-- #{coupon_date, #{coupon_expiration}, #{member_id} ) -->
			<!-- to_date(#{coupon_date}, 'YYYY-MM-DD HH24:mi'), to_date(#{coupon_expiration}, 'YYYY-MM-DD HH24:mi'), #{member_id} ) -->
	</insert>
	
	<!-- 쿠폰개수 조회 -->
	<select id="countCoupon" parameterType="coupon" resultType="int">
		<!-- select count(decode(member_id, #{member_id}, 1)) from coupon -->
		select count(*) from coupon where member_id = #{member_id}
	</select>
	
	<!-- 쿠폰리스트 조회 -->
	<select id="couponList" parameterType="coupon" resultType="coupon">
		select * from coupon where member_id = #{member_id}
	</select>
	
	<!--마케팅 동의  -->
	 <update id="email_check" parameterType="member" >
	update member set accept_mail = #{accept_mail} where member_id = #{member_id}
	</update> 

	<!-- 관리자 쿠폰 생성 -->
	<insert id="createCoupon" parameterType="coupon">
		insert into coupon values ( #{coupon_id}, #{coupon_name}, #{coupon_discount}, 
			#{coupon_date}, #{coupon_expiration}, #{member_id} )
			<!-- to_date(#{coupon_date}, 'YYYY-MM-DD HH24:mi'), to_date(#{coupon_expiration}, 'YYYY-MM-DD HH24:mi'), #{member_id}  ) -->
	</insert>
	
	<!-- 장바구니 추가-->
	<insert id="addCart" parameterType="cart">
		insert into cart values (cart_seq.nextval, #{member_id}, #{order_detail_pk})
	</insert>
	
	<!-- 장바구니 product 리스트-->
	<select id="productcartlist" parameterType="product" resultType="product">
		select * from product a left outer join order_detail b
		on a.product_id = b.product_id left outer join cart c 
		on b.order_detail_pk = c.order_detail_pk where c.member_id = #{member_id}
	</select>
	<!-- 장바구니 detail 리스트-->
	<select id="detailList" parameterType="order_detail" resultType="order_detail">
		select * from order_detail a left outer join cart b 
		on a.order_detail_pk = b.order_detail_pk where b.member_id = #{member_id}
	</select>

	
</mapper>

    